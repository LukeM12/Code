YUI.add("hermes-template-display-collection-justified",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i;r+="\n		",i=n.each.call(e,e.displayWrappers,{hash:{},inverse:a.noop,fn:a.program(2,h,t),data:t});if(i||i===0)r+=i;return r+="\n	",r}function h(e,t){var i="",s;i+="\n			",s=a.invokePartial(r["display-collection-justified-item"],"display-collection-justified-item",e,n,r,t);if(s||s===0)i+=s;return i+="\n		",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u,a=this,f="function",l=this.escapeExpression;s+='<section data-layout-element="displayCollection" style="'+l((o=(o=(o=t.layout,o==null||o===!1?o:o.styles),o==null||o===!1?o:o.displayCollection),typeof o===f?o.apply(t):o))+"\">\n	<script>\n		//getting the cookie with no library\n		var liqpw = (document.cookie.match(/liqpw\\s*=\\s*(\\d+)/) || [])[1] || 0;\n\n		//if cookie width is incorrect!\n		if (window.innerWidth != liqpw) {\n			document.body && document.body.classList.add('ui-state-wrong-cookie-width');\n		}\n	</script>\n	",u=n["if"].call(t,t.displayWrappers,{hash:{},inverse:a.noop,fn:a.program(1,c,i),data:i});if(u||u===0)s+=u;return s+="\n</section>\n",s}),r={};e.Array.each(["display-collection-justified-item"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/display-collection-justified",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-display-collection-justified-item"]});
YUI.add("layout-engine-justified",function(e){"use strict";var t,n=e.LayoutEngine.DisplayWrapper,r,i,s;i={debug:!1,vertPadding:8,horizPadding:8,bottomPadding:8,targetHeight:320,targetHeightTolerance:.25,maxHorizOverflow:5,gutterWidth:0,autoGutterToContentWidth:!1,bufferTop:3,bufferBottom:3},s={unWrapDisplayItem:function(e){return e.displayItem}},r=e.flutil.getLogger(i.debug),t=function(t){this.rows=[],this.currentRow=null,e.LayoutEngine.apply(this),this.options=e.flutil.extend({vertPadding:i.vertPadding,horizPadding:i.horizPadding,leftRightPadding:t.canvas==="fluidContainer"?0:i.horizPadding,bottomPadding:i.bottomPadding,targetHeight:i.targetHeight,gutterWidth:i.gutterWidth,autoGutterToContentWidth:i.autoGutterToContentWidth,targetHeightTolerance:i.targetHeightTolerance,viewport:null,container:null,monitorViewport:!0,scrolling:!0,template:e.flutil.getTemplate("display-collection-justified"),templatePartial:e.flutil.getTemplate("display-collection-justified-item")},t),this.init()},t.prototype=e.flutil.objectCreate(e.LayoutEngine.prototype,{init:function(t){t||(t=this.options),this.container=t.container,this.template=t.template,this.templatePartial=t.templatePartial,this.viewport=e.flutil.extend({width:800,height:600,scrollbarWidth:16},t.viewport),this.assignEventHandlers()},assignEventHandlers:function(){var t=this;!YUI.Env.isServer&&this.options.monitorViewport&&(this.options.singleRow||this.setViewportCookies(),this.options.scrolling&&this.scrollPolling(),e.use("global-events",function(e){t._resizeEventHandle=e.globalEvents.subscribe("window:resize",t.onResize.bind(t))}))},setViewportCookies:function(){e.flutil.setCookie({remove:!0,cookieName:"liqpw",path:"/",cookieValue:this.viewport.width+this.options.gutterWidth*2}),e.flutil.setCookie({remove:!0,cookieName:"liqph",path:"/",cookieValue:this.viewport.height})},scrollPolling:function(){var t,n=100,r=Math.floor(this.options.targetHeight/2),i=this;this._scroll=t={timer:null,offsetY:0,offsetVisibilityY:0,offsetTop:this.container.getY(),state:"still",shield:document.createElement("div"),shieldState:!1},t.shield.classList.add("ui-display-scrollshield"),document.body.appendChild(t.shield),t.timer=setInterval(function(){var s=e.config.win.pageYOffset;s===t.offsetY?(t.state!=="still"&&i.fire("scrollStop"),t.state="still",t.shieldState&&(t.shield.style.display="none"),t.shieldState=!1):(e.config.win.paftTiming&&(e.config.win.paftTiming=null),t.state="scroll",Math.abs(s-t.offsetY)<n?(t.shieldState&&(t.shield.style.display="none"),t.shieldState=!1):(t.shieldState||(t.shield.style.display="block"),t.shieldState=!0)),t.offsetY=s,Math.abs(s-t.offsetVisibilityY)>r&&(t.offsetVisibilityY=s,i.computeVisible())},250)},onResize:function(t){var n,r=this;switch(this.options.canvas){case"screen":case"container":n=e.config.win.innerWidth;break;case"fluidContainer":default:n=this.container.get("clientWidth")}return n?(this.options.singleRow?this.fire("resize",function(e,t){r.viewport.width=e,r.viewport.height=t,r.reflow()}):(this.options.autoGutterToContentWidth&&(this.options.gutterWidth=(n-this.options.autoGutterToContentWidth)/2),this.viewport.width=n-this.options.gutterWidth*2,this.viewport.height=e.config.win.innerHeight,this.setViewportCookies(),this.reflow()),!0):!1},computeVisible:function(){var t,n=[],r=[],o=[],u,a,f,l,c,h,p=this.rows.length,d,v,m,g;t=this._scroll?this._scroll.offsetY:e.config.win.pageYOffset,f=this.viewport.height*i.bufferTop,l=this.viewport.height*i.bufferBottom,c=t-f-this.options.targetHeight,h=t+this.viewport.height+l,u=t-this.options.targetHeight/2|0,a=t+this.viewport.height,d=this._scroll?this._scroll.offsetTop:this.container.getY(),this._bottom||(this._bottom=1);for(g=0;g<p;g++)v=this.rows[g],m=v.offsetTop+d,m>u&&m<a&&(o=o.concat(v.payload)),this.options.singleRow&&g>0?r=r.concat(v.payload):m<c?r=r.concat(v.payload):m>c&&m<h?(n=n.concat(v.payload),g===p-1&&g>this._bottom&&(this._bottom=g,this.fire("bottom",{row:this.rows[g]}))):m>h&&(r=r.concat(v.payload));this.fire("visibilitychanged",{viewsVisible:o.map(s.unWrapDisplayItem),viewsIn:n.map(s.unWrapDisplayItem),viewsOut:r.map(s.unWrapDisplayItem)})},scrollTo:function(t,n){var r,s,o;n=(n||0)-i.vertPadding;if(typeof t=="string"){for(r=0,s=this.payload.length;r<s;r++)if(this.payload[r].displayItem.photo.id===t){t=this.payload[r];break}}else if(!t.layout)for(r=0,s=this.payload.length;r<s;r++)if(this.payload[r].displayItem===t){t=this.payload[r];break}if(!t)return;o=function(){if(!o.ttl)return;if(o.view.container){var t=o.view.container.getDOMNode();t.scrollIntoView&&t.scrollIntoView(),n&&e.config.win.scrollBy(0,n);return}o.ttl--,setTimeout(o,10)},o.ttl=300,o.view=t,o()},addRow:function(){var t,n,r;t=this.rows.length,r=this.viewport.width-2*this.options.leftRightPadding-this.viewport.scrollbarWidth,n={vertPadding:this.options.vertPadding,horizPadding:this.options.horizPadding,targetHeight:this.options.targetHeight,targetHeightTolerance:this.options.targetHeightTolerance,width:this.options.infiniteRow?Number.MAX_VALUE:r},this.currentRow=new e.LayoutEngineJustifiedRow(n),this.currentRow.bindLayout({layoutEngine:this,rowIndex:t}),this.rows.push(this.currentRow)},getRowStackHeight:function(e){var t=e===undefined?this.rows.length:e+1,n=0,r;for(r=0;r<t;r++)n+=this.rows[r].height||this.rows[r].options.targetHeight;return n},append:function(e){if(!Array.isArray(e))return;var t,r={};this.container.all(".ui-display-wrapper").each(function(e){r[e.get("id")]=e}),t=e.map(function(e){var t=new n(e),i=r[t.getId()];return i&&t.setContainer(i),t}),this.payload=this.payload.concat(t),this.render(this.currentRow)},remove:function(e){e.forEach(function(e){e.remove()})},render:function(e){var t=this,n,r,i,s,o,u,a=[];if(!this.payload.length){this.fire("rendered");return}n=this.payload,e&&(this.currentRow=e,r=e.clear().shift(),n=this.payload.slice(this.payload.indexOf(r))),this.currentRow||this.addRow();for(o in n)i=n[o],t.currentRow.addItem(i),i.hasLayout()||(t.currentRow.render(),!s&&t.options.singleRow&&(
s=t.currentRow.height),t.addRow(),t.currentRow.addItem(i)),a.push(i);this.currentRow.end(),this.currentRow.render(),this.setStyles("displayCollection",{height:this.currentRow.offsetTop+this.currentRow.height+"px",position:"relative",margin:this.options.vertPadding+"px "+this.options.leftRightPadding+"px "+this.options.bottomPadding+"px "+(this.options.leftRightPadding+this.options.gutterWidth)+"px"}),s&&this.options.singleRow?u=s:u=this.currentRow.height,this.fire("adjustContainer",u),this.renderFragment(a),!this._cookieChecked&&!YUI.Env.isServer&&(this._cookieChecked=!0,setTimeout(function(){document.body.classList.remove("ui-state-wrong-cookie-width")},500))},reflow:function(){this.rows.forEach(function(e){e.destroy()}),this.rows=[],this.currentRow=null,this._bottom=null,this.render(),this.computeVisible(),this.fire("reflowed")},destroy:function(){this._scroll&&(this._scroll.shield.parentNode.removeChild(this._scroll.shield),this._scroll.shield=null,clearInterval(this._scroll.timer)),this._resizeEventHandle.detach(),this.rows.forEach(function(e){e.destroy()}),this.rows=null,this.currentRow=null,e.LayoutEngine.prototype.destroy.apply(this)}}),e.LayoutEngineJustified=t},"@VERSION@",{requires:["flutil","flickr-promise","layout-engine","layout-engine-justified-row","hermes-template-display-collection-justified","display-collection-justified-css"]});
YUI.add("display-collection-justified",function(e){"use strict";var t;t=e.Base.create("DisplayCollectionJustified",e.DisplayCollection,[],{initializer:function(t){var n,r={},i=t.gutterWidth||0,s=t.autoGutterToContentWidth||!1,o=this.get("container"),u;YUI.Env.isServer?(r.width=parseInt(this.appContext.getCookie("liqpw"),10),r.height=parseInt(this.appContext.getCookie("liqph"),10),r.scrollbarWidth=this.appContext.getCookie("liqsb")?parseInt(this.appContext.getCookie("liqsb"),10):16):this.options.canvas==="fluidContainer"?(u=e.one("."+o.getDOMNode().className.replace(" ",".")),u?r.width=u.get("clientWidth"):this._resizeQueued=!0,r.width||(r.width=parseInt(this.appContext.getCookie("liqpw"),10)),r.width||(r.width=e.config.win.innerWidth),r.scrollbarWidth=0):r.scrollbarWidth=function(){var t,n;return t=document.createElement("div"),t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),n=100-t.clientWidth,t.parentNode.removeChild(t),e.flutil.setCookie({remove:!0,cookieName:"liqsb",path:"/",cookieValue:n}),n}(),this.options=e.flutil.extend(this.options,{canvas:"container",hibernate:!0},t);switch(this.options.canvas){case"screen":this.options.viewport=e.flutil.extend({width:r.width||e.config.win.innerWidth||800,height:r.height||e.config.win.innerHeight||600,scrollbarWidth:r.scrollbarWidth},this.options.viewport),s&&(i=(this.options.viewport.width-s)/2),this.options.viewport.width-=i*2;break;case"fluidContainer":this.options.viewport=e.flutil.extend({width:r.width||800,height:r.height||e.config.win.innerHeight||600,scrollbarWidth:r.scrollbarWidth},this.options.viewport),s&&(i=(this.options.viewport.width-s)/2),this.options.viewport.width-=i*2;break;case"container":default:console.warn("This doesn't appear to be fully implemented yet. See note above about using canvas: 'container'."),this.options.viewport=e.flutil.extend({width:o.get("offsetWidth"),height:o.get("offsetHeight")||e.config.win.innerHeight,scrollbarWidth:r.scrollbarWidth},this.options.viewport)}return n=e.flutil.extend({},this.options,{container:o,gutterWidth:i,autoGutterToContentWidth:s}),this.setupLayoutEngine(n),this},setupLayoutEngine:function(t){var n=this,r=!0,i,s,o;i=this.options.beaconViews?function(e){var t=n.options.beaconViews,r=document.URL;e.forEach(function(e){t.queue(e.photo&&e.photo.id,r,"true")})}:function(){},s=this.options.hibernate?this._queueForHibernation.bind(this):function(){},YUI.Env.isServer||(o=e.config.win.scrollY),this.layout=new e.LayoutEngineJustified(t),this.layout.on("rendered",function(t){r&&!YUI.Env.isServer&&(r=!1,e.config.win.setTimeout(function(){n._resizeQueued&&n.layout.onResize?(n._resizeQueued=!1,n.layout.onResize(null)||n._resizePoll()):n.layout.computeVisible()},0)),n.fire("rendered",t)}),this.layout.on("resize",function(e){n.fire("resize",e)}),this.layout.on("adjustContainer",function(e){n.fire("adjustContainer",e)}),this.layout.on("reflowed",function(t){e.Views.dialog.close()}),this.layout.on("bottom",function(e){e.loading=n.next(),n.fire("bottom",e)}),this.layout.on("visibilitychanged",function(t){var r=t.viewsVisible,u=0;s("wake",t.viewsIn,function(){s("hibernate",t.viewsOut),YUI.Env.isServer||o!==e.config.win.scrollY&&n._updateScrollHistory(t.viewsVisible[0])}),e.config.win.paftTiming&&!e.config.win.paftTiming.final&&n.appContext.flipper.isFlipped("paft")&&(r.forEach(function(t){u<e.config.win.paftTiming[t.photo.id]&&(u=e.config.win.paftTiming[t.photo.id])}),n.appContext.clientMetrics&&(e.config.win.paftTiming.final=u,n.appContext.clientMetrics.record("photos_above_fold",u),n.appContext.clientMetrics.beaconLater())),i(t.viewsVisible)}),this.layout.on("scrollStop",function(){n.options.beaconViews&&n.options.beaconViews.flushQueue()})},positionFromHistory:function(){var t;if(YUI.Env.isServer)return;t=e.StorageHelper.getItem(this._generateLocationHash(),!0),t&&this.scrollToPhotoId(t,0)},scrollToPhotoId:function(e,t){this.layout.scrollTo(e,t)},_queueForHibernation:function(t,n,r){var i=25,s=n.length,o,u;if(!s)return r&&r();o=0,u=function(){var a,f=Math.min(s,o+i);for(a=o;a<f;a++)n[a][t]();if(f>=s-1)return r&&r();o=f-1,e.config.win.requestAnimationFrame(u)},e.config.win.requestAnimationFrame(u)},_updateScrollHistory:function(t){if(YUI.Env.isServer)return;t&&t.photo&&e.StorageHelper.setItem(this._generateLocationHash(),t.photo.id,!0)},_generateLocationHash:function(){var e="dc_scrollToPhotoId_"+document.location.pathname+document.location.search;return e.replace(/[^\w\d]/gi,"")},_resizePoll:function(e){function i(){setTimeout(function(){r.layout.onResize(null)||++n<t&&(e*=2,i())},e)}var t=5,n=0,r=this;e||(e=100),i()}}),e.DisplayCollectionJustified=t},"@VERSION@",{requires:["flutil","storage-helper","display-collection","layout-engine-justified","display-item-tile"]});
YUI.add("hermes-template-photo-collection",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["display-collection"],u):a.call(t,"outlet",t["display-collection"],u)))+'\n\n<div class="progress-indicator">\n	<span class="fetching-message">',u={hash:{intlName:"photo-list.FETCHING_PHOTOS"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</span>\n	<span class="fetching-more-message">',u={hash:{intlName:"photo-list.FETCHING_MORE_PHOTOS"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</span>\n	<span class="searching-message">',u={hash:{intlName:"photo-list.SEARCHING"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+"</span>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-collection",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("search-photos-collection-view",function(e){e.namespace("Views")[this.name]=e.Base.create("search-photos-collection-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.searchId=e.searchId,this.paft=e.paft,this},loadState:function(){var t=this,n;return n={appContext:this.appContext,container:this.get("container").one(".display-collection-justified"),beaconViews:this.appContext.getViewCounter({flushDelay:6e4}),canvas:"screen",displayItemExtras:{}},this.paft&&(n.displayItemExtras.paft=!0),this.displayCollection=new e.DisplayCollectionJustified(n),this.searchId?this.appContext.getModel("search-photos-models",this.searchId).then(function(n){return t.searchModel=n,t.searchCollection=new e.CollectionPaginator(n,"photos",{fetchPageSize:e.SearchHelper.FETCH_PAGE_SIZE}),t.searchCollection.passAttributesToFetcher("apiParams"),t.registerSubview(t.displayCollection),t.displayCollection.appendCollection(t.searchCollection),t.displayCollection.initialize()}):e.Promise.resolve()},buildContainer:function(){var e=this;return e.setContainerHTML(e.templates("photo-collection")({"display-collection":e.displayCollection,paft:e.paft})),this.displayCollection.positionFromHistory(),this},activate:function(){return this.registerEventHandler(this.displayCollection.on("bottom",function(e){this.searchModel.getValue("photos").fetchedEnd||this.displayLoadingIndicator("fetching-more")},this)),this.registerEventHandler(this.get("container").delegate("click",this.injectPhotolistContext.bind(this),"a")),this},displayLoadingIndicator:function(e){var t=this.get("container").one(".progress-indicator");t.addClass(e),t.addClass("progress-loading"),this.registerEventHandler(this.displayCollection.on("rendered",function(n){t.removeClass(e),t.removeClass("progress-loading")}))},injectPhotolistContext:function(t){var n=t.currentTarget.getAttribute("href"),r=e.URLHelper.PHOTOPAGE_PATTERN.exec(n),i,s,o,u;r&&r.length>=5&&(i=this.searchCollection.getCurrentPageAsList().map(function(e){return e.id}),s=i.indexOf(r[4]),o=i.slice(i).slice(s,s+50),o.length<50&&(o=i.slice(s-(50-o.length),s).concat(o)),u=n+"/in/photolist-"+e.URLHelper.generateShortenedPhotolist(o),t.halt(),e.rapidTracker.beacon(this.name,"searchPhotoResultClick",{vespaRnk:s+1}),this.appContext.lang.toLowerCase()==="en-us"?this.appContext.flapp.navigate(u):window.location=u)}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","collection-paginator","display-collection-justified","hermes-template-photo-collection","photo-collection-css","url-helper","search-helper"],optional:["search-photos-models"],langBundles:["search","photo-list"]});
YUI.add("hermes-lang-search",function(e,t){e.Intl.add("hermes/search","en-US",{RELEVANT:["Relevant"],RECENT:["Recent"],INTERESTING:["Interesting"],NAME:["Name"],ACTIVITY:["Activity"],SIZE:["Size"],OLDEST:["Oldest"],NEWEST:["Newest"],DEFAULT_SEARCH:['This is where you search Flickr. Here\'s a search for <span class="default-search">',"${query}","</span> to get you started!"],FLICKR_SEARCH:["Flickr Search"],NO_MATCHES_FOR_QUERY_TERM:["Oops! There are no matches for \u201c","${searchTerm}","\u201d."],NO_MATCHES_FOR_QUERY:["Oops! There are no matches for your search."],TRY_DIFFERENT:["Please try refining your search."],SEARCH_ERROR:["Oops! The date you entered does not exist."],SEARCH_START:["Start your search"],SEARCHING:["Searching"],FETCHING_PHOTOS:["Fetching more photos..."],SEARCH:["Search"],START_YOUR_SEARCH:["Start your search"],BY_USER:["by ","${user}"],NO_MATCHES_FOR_QUERY_TERM_CONTEXT_YOUR:["Oops! There are no matches for \u201c","${searchTerm}","\u201d in your photos."],NO_MATCHES_FOR_QUERY_TERM_CONTEXT_CONTACTS:["Oops! There are no matches for \u201c","${searchTerm}","\u201d in your contacts' photos."],NO_MATCHES_FOR_QUERY_TERM_CONTEXT_USER:["Oops! There are no matches for \u201c","${searchTerm}","\u201d in this user's photos."],NO_MATCHES_FOR_QUERY_TERM_CONTEXT_GROUP:["Oops! There are no matches for \u201c","${searchTerm}","\u201d in this group."],NO_MATCHES_FOR_QUERY_TERM_YOUR:["Oops! There are no matches for your search in your photos."],NO_MATCHES_FOR_QUERY_TERM_CONTACTS:["Oops! There are no matches for your search in your contacts' photos."],NO_MATCHES_FOR_QUERY_TERM_USER:["Oops! There are no matches for your search in this user's photos."],NO_MATCHES_FOR_QUERY_TERM_GROUP:["Oops! There are no matches for your search in this group."],API_ERROR_HEADER:["Oh noes! We couldn't process your search."],API_ERROR_SUBHEADER:["Please change it up a bit and try again."],YOUR_GROUPS:["Your groups"],ALL_FLICKR_GROUPS:["All Flickr groups"],MEMBER_COUNT:[{type:"plural",valueName:"count",options:{zero:"0 members",one:"${#} member",other:"${#} members"}}],GROUP_PHOTO_COUNT:[{type:"plural",valueName:"count",options:{zero:"no photos",one:"${#} photo",other:"${#} photos"}}],GROUP_DISCUSSION_COUNT:[{type:"plural",valueName:"count",options:{zero:"no discussions",one:"${#} discussion",other:"${#} discussions"}}],YOUR_PHOTOS:["Your photos"],YOUR_ALBUMS:["Your albums"],YOUR_GALLERIES:["Your galleries"],FROM_YOUR_CONTACTS:["From your contacts"],EVERYONES_PHOTOS:["Everyone's photos"],VIEW_ALL_COUNT:[{type:"plural",valueName:"count",options:{zero:"no more photos",one:"View ${#} more",other:"View all ${#}"}}],RESULTS_COUNT:[{type:"plural",valueName:"count",options:{zero:"no results",one:"${#} results",other:"${#} results"}}],PEOPLE_PHOTOS_COUNT:[{type:"plural",valueName:"count",options:{zero:"0 photos",one:"${#} photo",other:"${#} photos"}}],PEOPLE_VIDEOS_COUNT:[{type:"plural",valueName:"count",options:{zero:"no videos",one:"${#} video",other:"${#} videos"}}],PEOPLE_FOLLOWERS_COUNT:[{type:"plural",valueName:"count",options:{zero:"no followers",one:"${#} follower",other:"${#} followers"}}],SAFESEARCH_ON:["SafeSearch on"],SAFESEARCH_OFF:["SafeSearch off"],SAFESEARCH_MODERATE:["SafeSearch moderate"],ANY_LICENSE:["Any license"],ALL_CC:["All creative commons"],COMMERCIAL_USE:["Commercial use allowed"],MODS_ALLOWED:["Modifications allowed"],COMMERCIAL_USE_MODS:["Commercial use & mods allowed"],NO_RESTRICTIONS:["No known restrictions"],US_GOVT:["U.S. Government works"],PLAIN_COUNT:[{type:"plural",valueName:"count",options:{zero:"0",one:"${#}",other:"${#}"}}],PHOTOS:["Photos"],PHOTOS_POSSESSIVE:["${name}","'s photos"],FAVES_POSSESSIVE:["${name}","'s faves"],IN_GROUP_POOL:["In the ","${name}"," group pool"],OPT_OUT_MESSAGE:["Opt out of the search alpha"],OPT_IN_MESSAGE:["Opt in to the search alpha"],FROM_PEOPLE_YOU_FOLLOW:["From people you follow"],FULL_TEXT_AND_TAGS:["Full text with suggested tags"],FULL_TEXT:["Full text"],TAGS_ONLY:["Tags only"],RED:["red"],DARK_ORANGE:["dark orange"],ORANGE:["orange"],SCHOOL_BUS_YELLOW:["school bus yellow"],LEMON_YELLOW:["lemon yellow"],GREEN:["green"],LIME_GREEN:["dark lime green"],CYAN:["cyan"],BLUE:["blue"],VIOLET:["violet"],PINK:["pink"],PALE_PINK:["pale pink"],WHITE:["white"],GRAY:["gray"],BLACK:["black"],MONOCHROME:["monochrome"],ORIENTATION_AND_SIZE:["Orientation & size"],PORTRAIT:["Portrait"],SQUARE:["Square"],LANDSCAPE:["Landscape"],PANORAMA:["Panorama"],ALL_SIZES:["All sizes"],MEDIUM:["Medium"],LARGE:["Large"],CUSTOM:["Custom"],COLOR:["Color"],DATE:["Date"],FROM:["From"],TO:["To"],DATE_TAKEN:["Date taken"],DATE_POSTED:["Date posted"],CONTENT:["Content"],VIDEOS:["Videos"],SCREENSHOTS:["Screenshots"],ILLUSTRATIONS:["Illustrations"],SEARCH_IN:["Search in"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-lang-photo-list",function(e,t){e.Intl.add("hermes/photo-list","en-US",{FETCHING_PHOTOS:["Fetching photos..."],FETCHING_MORE_PHOTOS:["Fetching more photos..."],SEARCHING:["Searching..."]})},"@VERSION@",{requires:["intl"]});
YUI.add("togglebutton",function(e){"use strict";var t,n;t={css:{toggledOn:"ui-togglebutton-on",label:'span[data-action="toggle"]',disabled:"ui-togglebutton-disabled",icon:"ui-togglebutton-icon"},options:{}},e.namespace("Views").ToggleButton=n=e.Base.create("ToggleButton",e.FlickrView,[],{initializer:function(e){if(e.activate===!1)return;this.activate()},activate:function(){var n=this.get("container");n.getData("label")&&this.set("label",n.getData("label")),n.getData("labelToggled")&&this.set("labelToggled",n.getData("labelToggled")),this.labelEl=n.one(t.css.label),this.labelEl||(this.labelEl=e.Node.create('<span class="truncate" data-action="toggle" />'),n.insert(this.labelEl,0)),this.update(this.get("toggled")),this.get("showIcon")&&n.addClass(t.css.icon);if(this.get("disabled"))return this.disable();this.attachEvents({":toggle":this.toggle.bind(this)})},update:function(e){var n=this.get("container");e?(n.addClass(t.css.toggledOn),this.get("labelToggled")&&n.one(t.css.label).set("textContent",this.get("labelToggled"))):(n.removeClass(t.css.toggledOn),n.one(t.css.label).set("textContent",this.get("label")))},toggle:function(e){e,this.set("toggled",!this.get("toggled")),this.update(this.get("toggled")),this.fire("toggle",e,this.get("toggled")?"on":"off")},disable:function(){var e=this.get("container");this.set("disabled",!0),e.addClass(t.css.disabled),e.detach()},destructor:function(){this.labelEl=null,this.detachAll()}},{ATTRS:{disabled:{value:!1},toggled:{value:!1},label:{value:"Toggle Me"},labelToggled:{value:"Toggled!"},showIcon:{value:!1}}})},"@VERSION@",{requires:["flickr-view","flickrui-css"]});
YUI.add("hermes-template-filter-bar-neutered",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n<div class="fluid opt-out-bug">\n	<form id="optin" action="/help/optin" method="post">\n		<input type="hidden" name="unifiedgroupssearchpage_opt" value="1">\n		<input type="hidden" name="unifiedpeoplesearchpage_opt" value="1">\n		<input type="hidden" name="redirect_url" value="',(i=n.pageUrl)?i=i.call(e,{hash:{},data:t}):(i=e.pageUrl,i=typeof i===f?i.apply(e):i),r+=l(i)+'"></input>\n		<input type="hidden" name="csrf" value="',(i=n.csrf)?i=i.call(e,{hash:{},data:t}):(i=e.csrf,i=typeof i===f?i.apply(e):i),r+=l(i)+'"></input>\n		<button>',s={hash:{intlName:"search.OPT_IN_MESSAGE"},data:t},r+=l((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):c.call(e,"intlHTMLMessage",s)))+"</button>\n	</form>\n</div>\n",r}function d(e,t){var r="",i,s;return r+='\n						<li role="menuitem" data-track="searchFilterScopeYourPhotosClick" data-action="set" data-value="1" data-text="',s={hash:{intlName:"filter-bar.YOUR_PHOTOS"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.YOUR_PHOTOS"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+'</li>\n						<li role="menuitem" data-track="searchFilterScopeYourContactsPhotosClick" data-action="set" data-value="2" data-text="',s={hash:{intlName:"filter-bar.CONTACTS_PHOTOS"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.CONTACTS_PHOTOS"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+"</li>\n					",r}function v(e,t){var r="",i,s;return r+='\n						<li role="menuitem" data-track="searchFilterScopeContactPhotosClick" data-action="set" data-value="3" data-text="',s={hash:{intlName:"filter-bar.USER_PHOTOS",name:(i=e.personModel,i==null||i===!1?i:i.displayname)},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+' &nbsp;\u25be" data-nsid="'+l((i=(i=e.personModel,i==null||i===!1?i:i.nsid),typeof i===f?i.apply(e):i))+'">',s={hash:{intlName:"filter-bar.USER_PHOTOS",name:(i=e.personModel,i==null||i===!1?i:i.displayname)},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+"</li>\n					",r}function m(e,t){var r="",i,s;return r+='\n						<li role="menuitem" data-track="searchFilterScopeGroupPhotosClick" data-action="set" data-value="4" data-text="',s={hash:{intlName:"filter-bar.GROUP_PHOTOS",name:(i=e.groupModel,i==null||i===!1?i:i.title)},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+' &nbsp;\u25be" data-nsid="'+l((i=(i=e.groupModel,i==null||i===!1?i:i.id),typeof i===f?i.apply(e):i))+'">',s={hash:{intlName:"filter-bar.GROUP_PHOTOS",name:(i=e.groupModel,i==null||i===!1?i:i.title)},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+"</li>\n					",r}function g(e,t){var r="",i,s;return r+='\n		<li role="menuitem">\n			<div class="filter-cc-label ui-togglebutton ui-togglebutton-icon ui-unselectable-text" data-label="',s={hash:{intlName:"filter-bar.LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+':" data-labeltoggled="',s={hash:{intlName:"filter-bar.LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+':">\n				<span class="truncate filter-title" data-action="toggle"></span>\n			</div>\n		</li>\n		<li role="menuitem">\n			<div class="filter-cc-menu ui-dropdown ui-dropdown-closed ui-unselectable-text">\n				<span class="truncate filter-title" data-action="toggle"></span>\n				<span class="ui-dialog-arrow"></span>\n				<ul class="filter-submenu" role="menu">\n					<li role="menuitem" data-track="searchFilterLicenseAll" data-action="set" data-value="all" data-text="',s={hash:{intlName:"filter-bar.ANY_LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.ANY_LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+'</li>\n					<li role="menuitem" data-track="searchFilterLicenseCCOnly" data-action="set" data-value="cc" data-text="',s={hash:{intlName:"filter-bar.CC_LICENSE_PARENT"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.CC_LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+'</li>\n					<li role="menuitem" data-track="searchFilterLicenseCCCommericialUse" data-action="set" data-value="cc-comm" data-sub="cc" data-text="',s={hash:{intlName:"filter-bar.CC_LICENSE_PARENT"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.COMM_LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+'</li>\n					<li role="menuitem" data-track="searchFilterLicenseCCModifyAdaptBuild" data-action="set" data-value="cc-deriv" data-sub="cc" data-text="',s={hash:{intlName:"filter-bar.CC_LICENSE_PARENT"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+' &nbsp;\u25be">',s={hash:{intlName:"filter-bar.DERIV_LICENSE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+"</li>\n				</ul>\n			</div>\n		</li>\n		",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;a={hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i},u=(o=n.isFlipped||t.isFlipped,o?o.call(t,t.flippers,"opt-out-reboot-unified-search",a):c.call(t,"isFlipped",t.flippers,"opt-out-reboot-unified-search",a));if(u||u===0)s+=u;s+='\n<div class="filter-bar-content">\n\n	<ul class="filter-menu" role="menubar">\n		<li role="menuitem">\n			<div class="filter-sort-label ui-togglebutton ui-togglebutton-icon ui-unselectable-text" data-label="'
,a={hash:{intlName:"filter-bar.SORT_BY"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+':" data-labeltoggled="',a={hash:{intlName:"filter-bar.SORT_BY"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+':">\n				<span class="truncate filter-title" data-action="toggle"></span>\n			</div>\n		</li>\n		<li role="menuitem">\n			<div class="ui-dropdown ui-dropdown-closed ui-unselectable-text filter-sort-menu">\n				<span class="truncate filter-title" data-action="toggle"></span>\n				<span class="ui-dialog-arrow"></span>\n				<ul class="filter-submenu" role="menu">\n					<li role="menuitem" data-track="searchFilterSortRelevanceClick" data-action="set" data-value="relevance" data-text="',a={hash:{intlName:"filter-bar.RELEVANT"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.RELEVANT"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</li>\n					<li role="menuitem" data-track="searchFilterSortRecentClick" data-action="set" data-value="date-posted-desc" data-text="',a={hash:{intlName:"filter-bar.RECENT"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.RECENT"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</li>\n					<li role="menuitem" data-track="searchFilterSortInterestingClick" data-action="set" data-value="interestingness-desc" data-text="',a={hash:{intlName:"filter-bar.INTERESTING"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.INTERESTING"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</li>\n				</ul>\n			</div>\n		</li>\n		<li role="menuitem">\n			<div class="filter-search-label ui-togglebutton ui-togglebutton-icon ui-unselectable-text" data-label="',a={hash:{intlName:"filter-bar.SEARCH_IN"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+':" data-labeltoggled="',a={hash:{intlName:"filter-bar.SEARCH_IN"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+':">\n				<span class="truncate filter-title" data-action="toggle"></span>\n			</div>\n		</li>\n		<li role="menuitem">\n			<div class="search-scope-menu ui-dropdown ui-dropdown-closed ui-unselectable-text ui-dropdown-ellipsis">\n				<span class="truncate filter-title" data-action="toggle"></span>\n				<span class="ui-dialog-arrow"></span>\n				<ul class="filter-submenu" role="menu">\n					<li role="menuitem" data-track="searchFilterScopeEveryoneClick" data-action="set" data-value="0" data-text="',a={hash:{intlName:"filter-bar.EVERYONE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.EVERYONE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+"</li>\n\n					",u=n["if"].call(t,(o=t.viewer,o==null||o===!1?o:o.signedIn),{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;s+="\n\n					",u=n["if"].call(t,t.showUserOption,{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+="\n\n					",u=n["if"].call(t,t.groupModel,{hash:{},inverse:h.noop,fn:h.program(7,m,i),data:i});if(u||u===0)s+=u;s+='\n\n					<li role="menuitem" data-track="searchFilterScopeUsersClick" data-action="set" data-value="5" data-text="',a={hash:{intlName:"filter-bar.PEOPLE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.PEOPLE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</li>\n					<li role="menuitem" data-track="searchFilterScopeGroupsClick" data-action="set" data-value="6" data-text="',a={hash:{intlName:"filter-bar.GROUPS"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+' &nbsp;\u25be">',a={hash:{intlName:"filter-bar.GROUPS"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+"</li>\n				</ul>\n			</div>\n		</li>\n		",a={hash:{},inverse:h.noop,fn:h.program(9,g,i),data:i},u=(o=n.isFlipped||t.isFlipped,o?o.call(t,t.flippers,"enable-license-search",a):c.call(t,"isFlipped",t.flippers,"enable-license-search",a));if(u||u===0)s+=u;return s+='\n		<li role="menuitem" class="filter-bar-right">\n			<a href="/search/advanced/',(u=n.advancedSearchQueryStr)?u=u.call(t,{hash:{},data:i}):(u=t.advancedSearchQueryStr,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{intlName:"filter-bar.ADVANCED_SEARCH"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+"</a>\n		</li>\n	</ul>\n\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/filter-bar-neutered",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("filter-bar-neutered-view",function(e){var t;t={css:{sortMenu:".filter-sort-menu",sortLabel:".filter-sort-label",searchScopeMenu:".search-scope-menu",searchLabel:".filter-search-label",ccLabel:".filter-cc-label",ccMenu:".filter-cc-menu"}},e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.searchId=e.searchId,this.apiParams={},this.elementStates=this.setElementStates(e),this},subviewConfig:{},loadState:function(){var t=this,n,r,i=t.appContext.getViewer();return this.searchId?n=this.appContext.getModel("search-photos-models",this.searchId).then(function(n){var r=n.getValue("apiParams"),i,s=null,o=null;return t.searchModel=n,r.group_id?(i={},e.TypeValidator.matches.nsid(r.group_id)?i.id=r.group_id:i.pathAlias=r.group_id,s=t.appContext.getModel("group-pool-models",i)):s=e.Promise.resolve(),r.user_id?(i={},e.TypeValidator.matches.nsid(r.user_id)?i.id=r.user_id:i.pathAlias=r.user_id,o=t.appContext.getModel("person-models",i)):o=e.Promise.resolve(),e.Promise.all([s,o]).then(function(e){e[0]&&(t.groupModel=e[0]),e[1]&&(t.personModel=e[1])})}):n=e.Promise.resolve(),i.signedIn?r=t.appContext.getModel("person-preferences-models",i.nsid).then(function(e){t.personPreferencesModel=e}):r=e.Promise.resolve(),e.Promise.all([n,r]).then(function(){t.searchModel?t.apiParams=t.searchModel.getValue("apiParams"):e.SearchHelper.addParamDefaults(t.apiParams,t.personPreferencesModel)})},buildContainer:function(){var e="",t;return this.searchModel&&(e=this.generateAdvancedSearchQuery(this.searchModel.getValue("apiParams"))),YUI.Env.isServer?t=this.appContext.request.url:t=window.location.pathname,this.setContainerHTML(this.templates("filter-bar-neutered")({elements:this.elementStates,advancedSearchQueryStr:e,viewer:this.appContext.getViewer(),showUserOption:this.personModel&&this.personModel.getValue("nsid")!==this.appContext.getViewer().nsid,personModel:this.personModel&&this.personModel.toJSON(),groupModel:this.groupModel&&this.groupModel.toJSON(),flippers:this.appContext.flipper.toJSON(),csrf:this.appContext.auth.csrf?this.appContext.auth.csrf:"",pageUrl:t})),this},activate:function(){var n=this,r=this.appContext.getViewer(),i,s;return this.filterViews={},this.elementStates.searchScope&&(s=this.getSearchScopeState(this.apiParams,r,this.personModel),this.filterViews.searchLabel=this.createLabelButton(t.css.searchLabel),this.filterViews.searchScope=this.createSimpleDropdown(t.css.searchScopeMenu,s),this.registerEventHandler(this.filterViews.searchScope.on("selected",function(t){var r=e.clone(n.apiParams),i="/search/?";delete r.user_id,delete r.group_id,delete r.contacts;switch(t.clicked.value){case"1":r.user_id=n.appContext.getViewer().nsid;break;case"2":r.contacts="all";break;case"3":r.user_id=t.clicked.itemEl.getData("nsid");break;case"4":r.group_id=t.clicked.itemEl.getData("nsid");break;case"5":i="/search/people/?",r={q:n.apiParams.q||n.apiParams.text||n.apiParams.tags},n.classicNavigate(i+e.QueryString.stringify(r));break;case"6":i="/search/groups/?",r={q:n.apiParams.q||n.apiParams.text||n.apiParams.tags},n.classicNavigate(i+e.QueryString.stringify(r))}e.SearchHelper.addParamDefaults(r,n.personPreferencesModel),n.navigate(i+e.QueryString.stringify(r))})),this.bindOpenEvent(this.filterViews.searchScope)),this.elementStates.sort&&(this.filterViews.sortLabel=this.createLabelButton(t.css.sortLabel),s=this.apiParams[e.SearchHelper.API.sort],this.filterViews.sort=this.createSimpleDropdown(t.css.sortMenu,s),this.bindSelectedEvent(this.filterViews.sort,e.SearchHelper.API.sort),this.bindOpenEvent(this.filterViews.sort)),this.elementStates.license&&(this.filterViews.ccLabel=this.createLabelButton(t.css.ccLabel),s=this.determineLicenseForUI(this.apiParams[e.SearchHelper.API.license]||"all"),this.filterViews.creativeCommons=new e.Views.Dropdown({appContext:this.appContext,container:this.get("container").one(t.css.ccMenu),selected:s,hasDialogArrow:!0,useCheckMarks:!0,multiSelect:!1,multiSelectSub:!0,selectParent:!0,minimumSelected:1,shouldCreateShim:!1,autoSizeMenu:!1}),this.bindSelectedEvent(this.filterViews.creativeCommons,e.SearchHelper.API.license),this.bindOpenEvent(this.filterViews.creativeCommons)),i=this.get("container").one("#optin"),i&&this.registerEventHandler(i.on("submit",function(t){t.preventDefault(),e.use("opt-outer",function(e){e.optIn("reboot-unified-search"),i.submit()})})),n},getSearchScopeState:function(e,t,n){var r=0;return e.user_id&&e.group_id?t.signedIn&&n&&n.getValue("nsid")===t.nsid?r=1:r=3:t.signedIn&&e.group_id&&e.contacts?r=2:e.user_id?t.signedIn&&n&&n.getValue("nsid")===t.nsid?r=1:r=3:e.contacts?r=2:e.group_id&&(r=4),r},determineLicenseForAPI:function(t){var n,r=t.indexOf("all")>=0,i=t.indexOf("cc")>=0,s=t.indexOf("cc-comm")>=0,o=t.indexOf("cc-deriv")>=0;return r?n=e.SearchHelper.LICENSE_TYPE.all:i&&s&&o?n=e.SearchHelper.LICENSE_TYPE.commderiv:i&&s?n=e.SearchHelper.LICENSE_TYPE.comm:i&&o?n=e.SearchHelper.LICENSE_TYPE.deriv:i&&(n=e.SearchHelper.LICENSE_TYPE.cc),n},determineLicenseForUI:function(t){var n;switch(t){case e.SearchHelper.LICENSE_TYPE.commderiv:n=["cc","cc-comm","cc-deriv"];break;case e.SearchHelper.LICENSE_TYPE.comm:n=["cc","cc-comm"];break;case e.SearchHelper.LICENSE_TYPE.deriv:n=["cc","cc-deriv"];break;case e.SearchHelper.LICENSE_TYPE.cc:n=["cc"];break;default:n=["all"]}return n},classicNavigate:function(t){window.location=e.url(t)},createSimpleDropdown:function(t,n){return new e.Views.Dropdown({appContext:this.appContext,container:this.get("container").one(t),selected:n,useCheckMarks:!0,shouldCreateShim:!1,autoSizeMenu:!1})},createLabelButton:function(t){return new e.Views.ToggleButton({appContext:this.appContext,container:this.get("container").one(t)})},bindSelectedEvent:function(t,n){var r=this;this.registerEventHandler(t.on("selected",function(t){var i=r.apiParams,s={};n==="license"?s[n]=r.determineLicenseForAPI(t.selections):s[n]=t.clicked.value,i=e.merge(i,s),e.SearchHelper
.addParamDefaults(i,r.personPreferencesModel),!t.data||!t.data.track?r.appContext.warn("No data-track attribute found on clicked element. Not beaconing."):e.rapidTracker.beacon(r.name,t.data.track),r.navigate("/search/?"+e.QueryString.stringify(i))}))},navigate:function(e){e&&(this.fire("navigating"),this.appContext.flapp.navigate(e))},bindOpenEvent:function(t){var n=this;this.registerEventHandler(t.on("open",function(t){n.openDropdown&&n.openDropdown.close(),n.openDropdown=t.target,n.registerEventHandler(e.one("body").once("click",function(){n.openDropdown&&n.openDropdown.close()}))})),this.registerEventHandler(t.on("close",function(e){n.openDropdown=null}))},setElementStates:function(e){var t={searchScope:!0,sort:!0,license:this.appContext.flipper.isFlipped("enable-license-search")};return t},generateAdvancedSearchQuery:function(t){var n=e.SearchHelper.mapAPIParamsToAdvancedSearchQuery(t);return t.q&&(n.q=t.q),"?"+e.QueryString.stringify(n)},destructor:function(){var e;for(e in this.filterViews)this.filterViews[e].destroy()}})},"@VERSION@",{requires:["flickrui-css","dropdown","togglebutton","flickr-view","flickr-promise","person-models","group-pool-models","search-photos-models","search-helper","hermes-template-filter-bar-neutered","filter-bar-neutered-css","url"],langBundles:["filter-bar","search"]});
YUI.add("hermes-lang-filter-bar",function(e,t){e.Intl.add("hermes/filter-bar","en-US",{EVERYONE:["Everyone's Photos"],YOUR_PHOTOS:["Your Photos"],CONTACTS_PHOTOS:["Your Contacts' Photos"],USER_PHOTOS:["${name}","'s Photos"],GROUP_PHOTOS:["Photos in ","${name}"],PEOPLE:["People"],GROUPS:["Groups"],USER_PHOTOS_IN_GROUP:["${name}","'s Photos in ","${group}"],YOUR_PHOTOS_IN_GROUP:["Your Photos in ","${group}"],CONTACTS_PHOTOS_IN_GROUP:["Your Contacts' Photos in ","${group}"],YOUR_FAVORITES:["Your Favorites"],MORE:["More"],LESS:["Less"],PHOTOS_VIDEOS:["Photos & Videos"],ONLY_PHOTOS:["Only Photos"],ONLY_VIDEOS:["Only Videos"],ALL_TIME:["All Time"],DATE_TAKEN:["Date Taken"],DATE_POSTED:["Date Posted"],FROM:["From"],TO:["To"],MONTH_CHARS:["mm"],DAY_CHARS:["dd"],YEAR_CHARS:["yyyy"],DATE_INVALID:["Date invalid"],DONE:["Done"],DATE:["Date"],LICENSE:["License"],ANY_LICENSE:["Any License"],CC_LICENSE:["Creative Commons only"],CC_LICENSE_PARENT:["Creative Commons"],COMM_LICENSE:["Commercial use allowed"],DERIV_LICENSE:["Modifications allowed"],SS_ON:["SafeSearch on"],ON:["On"],SS_MOD:["SafeSearch moderate"],MOD:["Moderate"],SS_OFF:["SafeSearch off"],OFF:["Off"],RELEVANT:["Relevant"],RECENT:["Recent"],INTERESTING:["Interesting"],SORT_BY:["Sort"],SEARCH_IN:["Search"],ADVANCED_SEARCH:["Advanced Search"]})},"@VERSION@",{requires:["intl"]});
YUI.add("search-photos-page-view",function(e){e.namespace("Views")[this.name]=e.Base.create("search-photos-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.searchId=t.searchId,this.apiParams={},this.searchTerm=t.searchTerm,this.apiFailed=t.apiFailed;var n=this.name.replace(/-/g,"_");return this.appContext.flipper.isFlipped("paft")&&e.config.flickr.paft_metrics_samples&&e.config.flickr.paft_metrics_samples[n]&&(t.paft=!0),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,isSearchResults:!0},"filter-bar-neutered-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"search-photos-collection-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var t=this,n,r,i=this.appContext.getViewer(),s;return i.signedIn?r=this.appContext.getModel("person-preferences-models",i.nsid):r=e.Promise.resolve(),this.apiFailed?n=e.Promise.resolve():n=this.appContext.getModel("search-photos-models",this.searchId),s=e.Promise.all([r,n]),s.then(function(n){n[0]&&(t.personPreferencesModel=n[0]),n[1]?(t.searchModel=n[1],t.apiParams=t.searchModel.getValue("apiParams")):e.SearchHelper.addParamDefaults(t.apiParams,t.personPreferencesModel)}),s},additionalViewClasses:function(){var e=[];return this.appContext.flipper.isFlipped("opt-out-reboot-unified-search")&&e.push("enable-search-optin"),e},buildContainer:function(){var e="",t="",n="",r={apiFailed:!1,noQuery:!1,noMatchesForQuery:!1},i,s,o;return this.apiFailed?(r.apiFailed=!0,s=this.intlMessage({intlName:"search.SEARCH"}),t=this.subviews["filter-bar-neutered-view"].get("container"),n=this.subviews["footer-full-view"].get("container")):this.searchModel.getValue("photos").getList().length?(e=this.subviews["search-photos-collection-view"].get("container"),t=this.subviews["filter-bar-neutered-view"].get("container"),n=this.subviews["footer-full-view"].get("container")):this.searchModel.getValue("emptyQuery")?(r.noQuery=!0,s=this.intlMessage({intlName:"search.SEARCH_START"}),i=this.intlMessage({intlName:"search.BY_USER",user:"Gilles Couturier"})):(r.noMatchesForQuery=this.buildNoMatchesFoundMessage(),s=this.intlMessage({intlName:"search.SEARCH"}),t=this.subviews["filter-bar-neutered-view"].get("container"),n=this.subviews["footer-full-view"].get("container")),o={"global-nav-view":this.subviews["global-nav-view"].get("container"),"filter-bar-neutered-view":t,"search-photos-collection-view":e,searchState:r,searchPlaceholder:s,flippers:this.appContext.flipper.toJSON(),"footer-full-view":n,attribution:{link:"/photos/papy06/11384700923",by:i}},this.setContainerHTML(this.templates("search-photos-page")(o)),this},buildNoMatchesFoundMessage:function(){var t,n,r,i=this.appContext.getViewer();return n=this.searchModel.getValue("apiParams"),n.user_id?i.signedIn&&n.user_id===i.nsid?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_YOUR":r="search.NO_MATCHES_FOR_QUERY_TERM_YOUR":this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_USER":r="search.NO_MATCHES_FOR_QUERY_TERM_USER":n.contacts?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_CONTACTS":r="search.NO_MATCHES_FOR_QUERY_TERM_CONTACTS":n.group_id?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_GROUP":r="search.NO_MATCHES_FOR_QUERY_TERM_GROUP":this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM":r="search.NO_MATCHES_FOR_QUERY",this.searchTerm?t=this.intlMessage({intlName:r,searchTerm:e.flutil.unescape(this.searchTerm)}):t=this.intlMessage({intlName:r}),{noMatchesText:t}},activate:function(){var t=this,n;return this.registerEventHandler(this.subviews["filter-bar-neutered-view"].on("navigating",function(){var e=t.subviews["search-photos-collection-view"];e&&e.displayLoadingIndicator("searching")})),n=this.get("container").one("form.ui-large-search"),n&&this.registerEventHandler(n.on("submit",function(n){delete t.apiParams[e.SearchHelper.API.tags],t.apiParams[e.SearchHelper.API.text]=this.one("input").get("value"),e.SearchHelper.clearAdvancedSearchParams(t.apiParams),e.SearchHelper.addParamDefaults(t.apiParams,t.personPreferencesModel),t.appContext.flapp.navigate("/search/?"+e.QueryString.stringify(t.apiParams)),n.preventDefault()})),e.later(100,this,function(){t.appContext.flipper.isFlipped("enable-scrappy-photo-page")?e.use("photo-page-scrappy-view"):e.use("photo-page-view")}),this}},{ATTRS:{spaceid:{value:792600534}}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","search-helper","hermes-template-search-photos-page","search-photos-page-css","search-photos-collection-view","display-collection-justified","flickrui-css","footer-full-view","filter-bar-neutered-view","querystring-stringify-simple"],optional:["search-photos-models"],langBundles:["search"]});
YUI.add("hermes-template-search-photos-unified-page-view",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){return" collapsed"}function p(e,t){return' style="height:206px"'}function d(e,t){var r="",i,s;return r+='\n	<div class="albums-galleries">\n		<div class="l-col main search-your-albums-results">\n		',s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["search-photos-albums-view"],s):f.call(e,"outlet",e["search-photos-albums-view"],s)))+"\n		</div>\n		"+"\n	</div>\n	",r}function v(e,t){var r="",i,s;return r+='\n	<div class="main search-your-photos-results">\n		',s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["search-photos-yours-view"],s):f.call(e,"outlet",e["search-photos-yours-view"],s)))+"\n	</div>\n	",r}function m(e,t){var r="",i,s;return r+='\n	<div class="main search-contacts-results">\n		',s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["search-photos-contacts-view"],s):f.call(e,"outlet",e["search-photos-contacts-view"],s)))+"\n	</div>\n	",r}function g(e,t){var r="",i,s;return r+='\n	<div class="main search-photos-results">\n		',s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["search-photos-everyone-view"],s):f.call(e,"outlet",e["search-photos-everyone-view"],s)))+"\n	</div>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["global-nav-view"],a):f.call(t,"outlet",t["global-nav-view"],a)))+"\n\n",a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["search-subnav-view"],a):f.call(t,"outlet",t["search-subnav-view"],a)))+'\n\n<div class="advanced-search-wrapper',u=n.unless.call(t,t.advancedPanelVisible,{hash:{},inverse:c.noop,fn:c.program(1,h,i),data:i});if(u||u===0)s+=u;s+='"',u=n["if"].call(t,t.advancedPanelVisible,{hash:{},inverse:c.noop,fn:c.program(3,p,i),data:i});if(u||u===0)s+=u;s+=">\n",a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["search-advanced-panel"],a):f.call(t,"outlet",t["search-advanced-panel"],a)))+'\n</div>\n\n<main class="main group-centered-content" role="main">\n	',u=n["if"].call(t,t.showAlbums,{hash:{},inverse:c.noop,fn:c.program(5,d,i),data:i});if(u||u===0)s+=u;s+="\n	\n	",u=n["if"].call(t,t.showYours,{hash:{},inverse:c.noop,fn:c.program(7,v,i),data:i});if(u||u===0)s+=u;s+="\n\n	",u=n["if"].call(t,t.showContacts,{hash:{},inverse:c.noop,fn:c.program(9,m,i),data:i});if(u||u===0)s+=u;s+="\n\n	",u=n["if"].call(t,t.showEveryones,{hash:{},inverse:c.noop,fn:c.program(11,g,i),data:i});if(u||u===0)s+=u;return s+="\n\n</main>\n\n",a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["footer-full-view"],a):f.call(t,"outlet",t["footer-full-view"],a)))+"\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/search-photos-unified-page-view",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-search-subnav",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n	<div class="fluid opt-out-bug">\n		<form id="optout" action="/help/optin" method="post">\n			<input type="hidden" name="unifiedgroupssearchpage_opt" value="0">\n			<input type="hidden" name="debug" value="1">\n			<input type="hidden" name="unifiedpeoplesearchpage_opt" value="0">\n			<input type="hidden" name="redirect_url" value="',(i=n.pageUrl)?i=i.call(e,{hash:{},data:t}):(i=e.pageUrl,i=typeof i===f?i.apply(e):i),r+=l(i)+'">\n			<input type="hidden" name="csrf" value="',(i=n.csrf)?i=i.call(e,{hash:{},data:t}):(i=e.csrf,i=typeof i===f?i.apply(e):i),r+=l(i)+'">\n			<button>',s={hash:{intlName:"search.OPT_OUT_MESSAGE"},data:t},r+=l((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):c.call(e,"intlHTMLMessage",s)))+"</button>\n		</form>\n	</div>\n",r}function d(e,t){return" enable-search-opt-out"}function v(e,t){var r="",i,s,o;r+='\n				<li class="link',i=n["if"].call(e,e.selected,{hash:{},inverse:h.noop,fn:h.program(6,m,t),data:t});if(i||i===0)r+=i;r+='" data-id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'">\n					',i=n["if"].call(e,e.url,{hash:{},inverse:h.noop,fn:h.program(8,g,t),data:t});if(i||i===0)r+=i;r+='\n						<div class="title">',(i=n.title)?i=i.call(e,{hash:{},data:t}):(i=e.title,i=typeof i===f?i.apply(e):i),r+=l(i)+"</div>\n						",i=n["if"].call(e,e.subtitle,{hash:{},inverse:h.noop,fn:h.program(10,y,t),data:t});if(i||i===0)r+=i;r+='\n						\n						<div class="subtitle">',o={hash:{intlName:"search.PLAIN_COUNT",count:e.count},data:t},r+=l((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,o):c.call(e,"intlHTMLMessage",o)))+"</div>\n						"+"\n					",s=n["if"].call(e,e.url,{hash:{},inverse:h.noop,fn:h.program(12,b,t),data:t});if(s||s===0)r+=s;return r+="\n				</li>\n			",r}function m(e,t){return" selected"}function g(e,t){var r="",i;return r+='<a href="',(i=n.url)?i=i.call(e,{hash:{},data:t}):(i=e.url,i=typeof i===f?i.apply(e):i),r+=l(i)+'">',r}function y(e,t){var r="",i;return r+='\n						<div class="subtitle">',(i=n.subtitle)?i=i.call(e,{hash:{},data:t}):(i=e.subtitle,i=typeof i===f?i.apply(e):i),r+=l(i)+"</div>\n						",r}function b(e,t){return"</a>"}function w(e,t){var r="",i;return r+='\n				<li class="tool" data-id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'"> \n					<a href="#" class="menu-anchor">'+l((i=(i=e.selectedSort,i==null||i===!1?i:i.text),typeof i===f?i.apply(e):i))+"<span></span></a>\n				</li>\n				",r}function E(e,t){var r="",i;r+='\n				<li class="tool toggle toggle-justified',i=n["if"].call(e,e.viewTypeJustified,{hash:{},inverse:h.noop,fn:h.program(6,m,t),data:t});if(i||i===0)r+=i;r+='" data-id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'"> \n					<a href="',(i=n.justUrl)?i=i.call(e,{hash:{},data:t}):(i=e.justUrl,i=typeof i===f?i.apply(e):i),r+=l(i)+'" title="Justified View" class="toggle-view just"></a>\n				</li>\n				<li class="tool toggle toggle-thumb',i=n.unless.call(e,e.viewTypeJustified,{hash:{},inverse:h.noop,fn:h.program(6,m,t),data:t});if(i||i===0)r+=i;return r+='" data-id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'"> \n					<a href="',(i=n.thumbUrl)?i=i.call(e,{hash:{},data:t}):(i=e.thumbUrl,i=typeof i===f?i.apply(e):i),r+=l(i)+'" title="Thumbmnail View" class="toggle-view thumb"></a>\n				</li>\n				',r}function S(e,t){var r="",i;return r+='\n				<li class="tool toggle toggle-advanced" data-id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'">\n					<a title="Toggle Advanced" href="#"></a>\n				</li>\n				',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;a={hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i},u=(o=n.isFlipped||t.isFlipped,o?o.call(t,t.flippers,"enable-search-optout",a):c.call(t,"isFlipped",t.flippers,"enable-search-optout",a));if(u||u===0)s+=u;s+='\n<div class="search-subnav',a={hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i},u=(o=n.isFlipped||t.isFlipped,o?o.call(t,t.flippers,"enable-search-optout",a):c.call(t,"isFlipped",t.flippers,"enable-search-optout",a));if(u||u===0)s+=u;s+='">\n\n	<div class="search-subnav-sizing">\n\n		<div class="search-subnav-content">\n		\n			<ul class="links">\n\n			',u=n.each.call(t,t.links,{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+='\n\n			</ul>\n\n			<ul class="tools">\n			\n				',u=n["if"].call(t,t.showSort,{hash:{},inverse:h.noop,fn:h.program(14,w,i),data:i});if(u||u===0)s+=u;s+="\n				",u=n["if"].call(t,t.showTools,{hash:{},inverse:h.noop,fn:h.program(16,E,i),data:i});if(u||u===0)s+=u;s+="\n				",u=n["if"].call(t,t.showAdvanced,{hash:{},inverse:h.noop,fn:h.program(18,S,i),data:i});if(u||u===0)s+=u;return s+="\n\n\n			</ul>\n		</div>\n\n	</div>\n\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/search-subnav",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("search-subnav-view",function(e){"use strict";var t={css:{links:".search-subnav .links li",linkContainer:"li"}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.searchUrl=new e.SearchUrl(t.modelParams.apiParams,this.appContext),this.searchId=t.searchId,this.apiParams=t.modelParams.apiParams,this.sortMenuItems=this.buildSortMenuItems(t.sortMenuItems,t.modelParams.apiParams),this.showTools=t.showTools||!1,this.showSort=t.showSort||!1,this.showAdvanced=t.showAdvanced||!1,this.selectedTabKey=t.selectedTabKey||"photos",this},loadState:function(){var e=this;return this.appContext.getModel("search-counts-models",this.searchId).then(function(t){var n=e.searchUrl.clone(),r=e.searchUrl.clone(),i=e.searchUrl.clone();n.removeAPIParam("view_all").removeAPIParam("user_id").removeAPIParam("contacts").removeAPIParam("advanced").removeAPIParam("album_search").removeAPIParam("media").removeAPIParam("sort"),r.removeAPIParam("sort").removeAPIParam("view_all").removeAPIParam("user_id"),i.removeAPIParam("sort").removeAPIParam("view_all").removeAPIParam("user_id"),e.set("links",[{id:"photos",title:"Photos",count:t.getValue("everyonePhotos"),selected:e.selectedTabKey==="photos",url:n.getURL()},{id:"people",title:"People",count:t.getValue("people"),selected:e.selectedTabKey==="people",url:r.getURL().replace(/search/,"search/people")},{id:"groups",title:"Groups",count:t.getValue("groups"),selected:e.selectedTabKey==="groups",url:i.getURL().replace(/search/,"search/groups")}]),e.apiParams.sort?e.selectedSort=e.sortMenuItemsBySortParam[e.apiParams.sort]:e.selectedSort=e.sortMenuItems[0],e.viewTypeJustified=!e.apiParams.view_type||e.apiParams.view_type==="justified",e.justUrl=e.searchUrl.clone().setAPIParam("view_type","justified").getURL(),e.thumbUrl=e.searchUrl.clone().setAPIParam("view_type","thumbs").getURL()},function(e){})},buildContainer:function(){return this.setContainerHTML(this.templates("search-subnav")({showTools:this.showTools,flippers:this.appContext.flipper.toJSON(),selectedSort:this.selectedSort,showSort:this.showSort,viewTypeJustified:this.viewTypeJustified,sorts:this.sortMenuItems,thumbUrl:this.thumbUrl,justUrl:this.justUrl,pageUrl:this.searchUrl.getURL(),showAdvanced:this.showAdvanced,links:this.get("links"),csrf:this.appContext.auth.csrf?this.appContext.auth.csrf:""})),this},activate:function(){var n=this.get("container"),r=this,i=e.one("#optout");return this.registerEventHandler(n.all(t.css.links).on("click",e.bind(this.handleSubnavEvent,this))),this.showAdvanced&&this.registerEventHandler(e.one(".toggle-advanced").on("click",function(e){e.preventDefault(),r.fire("subviewViewEvent","tool","click","toggle-advanced")})),this.showSort&&(this.sortMenu=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,anchorElement:e.one(".menu-anchor span"),menuItems:this.sortMenuItems}),this.registerEventHandler(e.one(".menu-anchor").on("click",function(){r.sortMenu.show()})),this.sortMenu.on("selected",function(e){r.fire("subviewViewEvent","dirty")})),i&&this.registerEventHandler(i.on("submit",function(t){t.preventDefault(),e.use("opt-outer",function(e){e.optOut("reboot-unified-search"),setTimeout(function(){i.submit()},100)})})),this},buildSortMenuItems:function(t,n){var r,i,s=new e.SearchUrl(n,this.appContext);return t||(t=[],s.setAPIParam("sort",e.SearchHelper.API_SORT_OPTIONS.relevant),t.push({text:this.intlMessage({intlName:"search.RELEVANT"}),href:s.getURL()}),s.setAPIParam("sort",e.SearchHelper.API_SORT_OPTIONS.recent),t.push({text:this.intlMessage({intlName:"search.RECENT"}),href:s.getURL()}),s.setAPIParam("sort",e.SearchHelper.API_SORT_OPTIONS.interesting),t.push({text:this.intlMessage({intlName:"search.INTERESTING"}),href:s.getURL()})),this.sortMenuItemsBySortParam=i={},t.forEach(function(t){r=e.QueryString.parse(t.href.split("?")[1]),r.sort&&(i[r.sort]=t)}),t},handleSubnavEvent:function(n){var r=null,i=null,s=null,o=null;n&&(i=n.type,n.target&&n.target instanceof e.Node?(r=n.target.ancestor(t.css.linkContainer,!0).getData("id"),o=this.findLink(r)||this.findTool(r),s=o.type):(o=n,s=undefined)),this.fire("subviewViewEvent","dirty"),this.fire("subviewViewEvent",s,i,o)},findLink:function(e){var t=this.get("links"),n=null,r=0;for(r=0;r<t.length;r++)if(t[r].id===e){n=t[r];break}return n},findTool:function(e){var t=this.get("tools"),n=null,r=0;for(r=0;r<t.length;r++)if(t[r].id===e){n=t[r];break}return n},removeLink:function(e){var t=this.get("links"),n=!1,r=0,i=null;i=typeof e=="object"&&e.id?e.id:e;for(r=0;r<t.length;r++)if(t[r].id===i){t.splice(r,1),n=!0;break}return n},toolLink:function(e){var t=this.get("tools"),n=!1,r=0,i=null;i=typeof e=="object"&&e.id?e.id:e;for(r=0;r<t.length;r++)if(t[r].id===i){t.splice(r,1),n=!0;break}return n},isValidLink:function(e){var t=!0;return typeof e!="object"?(console.warn("`link` must be an object with an `id` and `title`."),t=!1):typeof e.id=="undefined"?(console.warn("`link` must be an object with an `id`."),t=!1):typeof e.title=="undefined"&&(console.warn("`link` must be an object with an `title`."),t=!1),t},isValidTool:function(e){var t=!0;return typeof e!="object"?(console.warn("`tool` must be an object with an `id`."),t=!1):typeof e.id=="undefined"&&(console.warn("`tool` must be an object with an `id`."),t=!1),t}},{ATTRS:{contentWidth:{value:"100%"},contentPaddingLeft:{value:"0px"},contentPaddingRight:{value:"0px"},links:{value:[],setter:function(e,t){var n=0;for(n=0;n<e.length;n++)e[n].type="link";return e},validator:function(e,t){var n=!0,r=0;for(r=0;r<e.length;r++)if(!this.isValidLink(e[r])){n=!1;break}return n}},tools:{value:[],setter:function(e,t){var n=0;for(n=0;n<e.length;n++)e[n].type="tool";return e},validator:function(e,t){var n=!0,r=0;for(r=0;r<e.length;r++)if(!this.isValidTool(e[r])){n=!1;break}return n}}}})},"@VERSION@",{requires:["flickr-view","fluid-css","search-url","dropdown","search-subnav-css","hermes-template-search-subnav","search-helper","querystring-parse-simple"
],optionalRequires:["fluid","fluid-droparound-view"],langBundles:["search"]});
YUI.add("hermes-template-search-photos-albums",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){return"\n"}function c(e,t){var r="",i,s,o;r+="\n	<h4>",o={hash:{intlName:"search.YOUR_ALBUMS"},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,o):a.call(e,"intlMessage",o)))+" ",s=n["if"].call(e,e.loading,{hash:{},inverse:f.program(6,p,t),fn:f.program(4,h,t),data:t});if(s||s===0)r+=s;r+="</h4>\n	",s=n["if"].call(e,e.loading,{hash:{},inverse:f.program(11,m,t),fn:f.program(9,v,t),data:t});if(s||s===0)r+=s;return r+="	\n",r}function h(e,t){return'<span class="balls"></span>'}function p(e,t){var r;return r=n.unless.call(e,e.viewingAll,{hash:{},inverse:f.noop,fn:f.program(7,d,t),data:t}),r||r===0?r:""}function d(e,t){var r="",i,s;return r+='<a href="',(i=n.viewAllLink)?i=i.call(e,{hash:{},data:t}):(i=e.viewAllLink,i=typeof i===o?i.apply(e):i),r+=u(i)+'" class="view-more-link secondary">',s={hash:{intlName:"search.VIEW_ALL_COUNT",count:e.total},data:t},r+=u((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):a.call(e,"intlHTMLMessage",s)))+"</a>",r}function v(e,t){var r="",i;return r+='\n		<div style="height: ',(i=n.placeholderHeight)?i=i.call(e,{hash:{},data:t}):(i=e.placeholderHeight,i=typeof i===o?i.apply(e):i),r+=u(i)+'px;"></div>\n	',r}function m(e,t){var r="",i;r+="\n		",i=n.each.call(e,e.albums,{hash:{},inverse:f.noop,fn:f.program(12,g,t),data:t});if(i||i===0)r+=i;return r+="\n	",r}function g(e,t){var r="",i,s,f;return r+='\n		<a href="',(i=n.url)?i=i.call(e,{hash:{},data:t}):(i=e.url,i=typeof i===o?i.apply(e):i),r+=u(i)+'"><div class="avatar album huge" style="background-image:url('+u((i=(i=(i=e.primaryPhotoSizes,i==null||i===!1?i:i.q),i==null||i===!1?i:i.src),typeof i===o?i.apply(e):i))+')">\n			<sup>',(s=n.title)?s=s.call(e,{hash:{},data:t}):(s=e.title,s=typeof s===o?s.apply(e):s),r+=u(s)+"</sup>\n			<sub>",f={hash:{intlName:"search.GROUP_PHOTO_COUNT",count:e.photoCount},data:t},r+=u((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,f):a.call(e,"intlHTMLMessage",f)))+"</sub>\n		</div></a>\n		",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=n.helperMissing,f=this;return s=n["if"].call(t,t.emptySearch,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i}),s||s===0?s:""}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/search-photos-albums",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("search-photos-albums-view",function(e){var t=120;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,emptySearch:!1,initializer:function(n){var r;return this.get("container").get("innerHTML")===""&&(r=this.templates("search-photos-albums")({loading:!0,placeholderHeight:t}),this.setContainerHTML(r)),this.searchUrl=new e.SearchUrl(n.modelParams.apiParams,this.appContext),this.searchTerm=n.searchTerm,this.viewingAll=n.modelParams.apiParams.view_all||n.searchType!==e.SearchUrl.searchTypes.UNIFIED,this},loadState:function(){var e=this,t,n,r;return r=this.appContext.getViewer().nsid,n=r+this.searchTerm,t=this.appContext.getModel("search-sets-models",{id:n,apiParams:{user_id:r,text:this.searchTerm}},{perPage:5}),t.then(function(t){var n=t.getValue("sets"),r;n&&(r=n.toJSON(),r.length<1&&(e.emptySearch=!0)),e.searchModel=t}),t},buildContainer:function(){var e,t;return this.searchUrl.setAPIParam("album_search",!0),this.searchUrl.setAPIParam("view_all",!0),e={albums:this.searchModel.getValue("sets").toJSON(),total:this.searchModel.getValue("totalItems"),emptySearch:this.emptySearch,viewAllLink:this.searchUrl.getURL(),viewingAll:this.viewingAll},t=this.templates("search-photos-albums")(e),this.setContainerHTML(t),this},activate:function(){return this}},{ATTRS:{}})},"@VERSION@",{requires:["flickr-view","flickr-promise","search-url","hermes-template-search-photos-albums"],langBundles:["search","common"]});
YUI.add("hermes-template-search-photos-single-row",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){return"\n"}function c(e,t){var r="",i,s,o;r+="\n	<h4>",o={hash:{intlName:e.title},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,o):a.call(e,"intlMessage",o)))+" ",s=n["if"].call(e,e.loading,{hash:{},inverse:f.program(6,p,t),fn:f.program(4,h,t),data:t});if(s||s===0)r+=s;r+="</h4>\n	",s=n["if"].call(e,e.loading,{hash:{},inverse:f.program(10,v,t),fn:f.program(8,d,t),data:t});if(s||s===0)r+=s;return r+="\n",r}function h(e,t){return'<span class="balls"></span>'}function p(e,t){var r="",i,s;return r+='<a href="',(i=n.viewAll)?i=i.call(e,{hash:{},data:t}):(i=e.viewAll,i=typeof i===o?i.apply(e):i),r+=u(i)+'" class="view-more-link secondary">',s={hash:{intlName:"search.VIEW_ALL_COUNT",count:e.total},data:t},r+=u((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):a.call(e,"intlHTMLMessage",s)))+"</a>",r}function d(e,t){var r="",i;return r+='\n		<div style="height: ',(i=n.placeholderHeight)?i=i.call(e,{hash:{},data:t}):(i=e.placeholderHeight,i=typeof i===o?i.apply(e):i),r+=u(i)+'px;"></div>\n	',r}function v(e,t){var r="",i,s;return r+="\n		",s={hash:{},data:t},r+=u((i=n.outlet||e.outlet,i?i.call(e,e["photo-list-view"],s):a.call(e,"outlet",e["photo-list-view"],s)))+"\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=n.helperMissing,f=this;return s=n["if"].call(t,t.emptySearch,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i}),s||s===0?s:""}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/search-photos-single-row",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-list-view-placeholder",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression;return s+='<div \n	class="photo-list-view-placeholder item',(o=n.id)?o=o.call(t,{hash:{},data:i}):(o=t.id,o=typeof o===a?o.apply(t):o),s+=f(o)+'" \n	style="	width: '+f((o=(o=t.geometry,o==null||o===!1?o:o.width),typeof o===a?o.apply(t):o))+"px;\n			height: "+f((o=(o=t.geometry,o==null||o===!1?o:o.height),typeof o===a?o.apply(t):o))+"px;\n			-webkit-transform: translate("+f((o=(o=t.geometry,o==null||o===!1?o:o.left),typeof o===a?o.apply(t):o))+"px, "+f((o=(o=t.geometry,o==null||o===!1?o:o.top),typeof o===a?o.apply(t):o))+"px);\n			transform: translate("+f((o=(o=t.geometry,o==null||o===!1?o:o.left),typeof o===a?o.apply(t):o))+"px, "+f((o=(o=t.geometry,o==null||o===!1?o:o.top),typeof o===a?o.apply(t):o))+'px)"\n	data-id="',(u=n.id)?u=u.call(t,{hash:{},data:i}):(u=t.id,u=typeof u===a?u.apply(t):u),s+=f(u)+'"\n	data-is-awake="',(u=n.isAwake)?u=u.call(t,{hash:{},data:i}):(u=t.isAwake,u=typeof u===a?u.apply(t):u),s+=f(u)+'">\n	<img src="'+f((o=(o=t.photo,o==null||o===!1?o:o.url),typeof o===a?o.apply(t):o))+'" width="'+f((o=(o=t.geometry,o==null||o===!1?o:o.width),typeof o===a?o.apply(t):o))+'" height="'+f((o=(o=t.geometry,o==null||o===!1?o:o.height),typeof o===a?o.apply(t):o))+'" />\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-list-view-placeholder",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-list-layout-row",function(e){var t=e.PhotoListLayoutRow=function(e){this.top=e.top,this.left=e.left,this.width=e.width,this.spacing=e.spacing,this.targetRowHeight=e.targetRowHeight,this.targetRowHeightTolerance=e.targetRowHeightTolerance,this.minAspectRatio=this.width/e.targetRowHeight*(1-e.targetRowHeightTolerance),this.maxAspectRatio=this.width/e.targetRowHeight*(1+e.targetRowHeightTolerance),this.edgeCaseMinRowHeight=e.edgeCaseMinRowHeight||Number.NEGATIVE_INFINITY,this.edgeCaseMaxRowHeight=e.edgeCaseMaxRowHeight||Number.POSITIVE_INFINITY,this.rightToLeft=e.rightToLeft,this.items=[],this.height=0};t.prototype={addItem:function(t){var n=this.items.concat(t),r=this.width-(n.length-1)*this.spacing,i=n.reduce(function(e,t){return e+t.aspectRatio},0),s=r/this.targetRowHeight,o,u,a;return i===0?!1:i<this.minAspectRatio?(this.items.push(e.merge(t)),!0):i>this.maxAspectRatio?this.items.length===0?(this.items.push(e.merge(t)),this._completeLayout(r/i),!0):(o=this.width-(this.items.length-1)*this.spacing,u=this.items.reduce(function(e,t){return e+t.aspectRatio},0),a=o/this.targetRowHeight,Math.abs(i-s)>Math.abs(u-a)?(this._completeLayout(o/u),!1):(this.items.push(e.merge(t)),this._completeLayout(r/i),!0)):(this.items.push(e.merge(t)),this._completeLayout(r/i),!0)},forceComplete:function(e,t){var n=this.width-(this.items.length-1)*this.spacing,r=this.items.reduce(function(e,t){return e+t.aspectRatio},0);typeof t=="number"?this._completeLayout(t,!1):e?this._completeLayout(n/r):this._completeLayout(this.targetRowHeight,!1)},isLayoutComplete:function(){return this.height>0},getItems:function(){return this.rightToLeft?this.items.reverse():this.items},getIndexOfItem:function(e){var t=-1;return this.items.some(function(n,r){if(n.id===e)return t=r,!0}),t},setTop:function(e){this.top=e,this.items.forEach(function(t){t.geometry.top=e})},_completeLayout:function(e,t){var n=this.rightToLeft?-this.left:this.left,r=this.width-(this.items.length-1)*this.spacing,i,s,o,u,a,f,l=this;typeof t=="undefined"&&(t=!0),s=Math.round(e),o=Math.max(this.edgeCaseMinRowHeight,Math.min(s,this.edgeCaseMaxRowHeight)),s!==o?(this.height=o,i=r/o/(r/s)):(this.height=s,i=1),this.items.forEach(function(e,t){e.geometry={top:l.top,width:Math.round(e.aspectRatio*l.height*i),height:l.height},l.rightToLeft?e.geometry.left=l.width-n-e.geometry.width:e.geometry.left=n,n+=e.geometry.width+l.spacing}),t&&(this.rightToLeft||(n-=2*this.spacing),u=(n-this.width)/this.items.length,a=this.items.map(function(e,t){return Math.round((t+1)*u)}),this.items.length===1?(f=this.items[0].geometry,f.width-=Math.round(u),this.rightToLeft&&(f.left+=Math.round(u))):this.items.forEach(function(e,t){t>0?(e.geometry.left-=a[t-1],e.geometry.width-=a[t]-a[t-1]):e.geometry.width-=a[t]}))}}},"@VERSION@",{requires:[]});
YUI.add("photo-list-layout",function(e){var t={containerPadding:{top:8,right:8,bottom:8,left:8},itemSpacing:{horizontal:8,vertical:8},targetRowHeight:320,targetRowHeightTolerance:.25,awakeBoundsToViewportSizeRatio:3,maxNumRows:Number.POSITIVE_INFINITY,forceAspectRatio:Number.NaN,alwaysDisplayOrphans:!1},n=1060,r=e.PhotoListLayout=function(n){if(!n.appContext)throw new Error("PhotoListLayout must be instantiated with `params.appContext`.");n=e.merge(t,n),this.appContext=n.appContext,this.containerWidth=n.containerWidth,this.viewportContainerNodeHeight=n.viewportContainerNodeHeight||this.appContext.viewportData.getHeight(),this.containerPadding=n.containerPadding,this.itemSpacing=n.itemSpacing,this.targetRowHeight=n.targetRowHeight,this.targetRowHeightTolerance=n.targetRowHeightTolerance,this.awakeBoundsToViewportSizeRatio=n.awakeBoundsToViewportSizeRatio,this.maxNumRows=n.maxNumRows,this.forceAspectRatio=n.forceAspectRatio,this.alwaysDisplayOrphans=n.alwaysDisplayOrphans,this._layoutItems=[],this._awakeItems=[],this._leadingOrphans=[],this._trailingOrphans=[],this._containerHeight=this.containerPadding.top,this._rows=[],this._orphans=[]};r.prototype={getCurrentLayout:function(){return this._layoutItems.concat()},getAwakeItems:function(){return this._awakeItems.concat()},hasLimitedNumberOfRows:function(){return this.maxNumRows!==t.maxNumRows},getLayoutItem:function(e){var t=null;return this._layoutItems.some(function(n){if(n.id===e)return t=n,!0}),t},getItemsInRow:function(e){return this._rows.length<=e?[]:this._rows[e].items.concat()},invalidateItem:function(e){var t,n=function(n,r,i){if(n.id===e)return i.splice(r,1),t=!0,!0};return this._layoutItems.some(n),this._leadingOrphans.some(n),this._trailingOrphans.some(n),this._rows.some(function(e){return e.items.some(n)}),this._orphans.some(n),t},computeLayout:function(e,t,r){var i={},s,o=[],u=[],a=[],f=!1,l,c,h,p,d,v,m=this;this.containerWidth||(this.appContext.warn("No valid containerWidth set on photo-list-layout; falling back to "+n+"."),this.containerWidth=n),e||(e=[]),this.forceAspectRatio&&e.forEach(function(e){e.forcedAspectRatio=!0,e.aspectRatio=m.forceAspectRatio}),s=this._layoutItems.concat(),this._layoutItems.forEach(function(e){i[e.id]=e}),r||(r={diffType:"append"});switch(r.diffType){case"prepend":e=e.concat(this._leadingOrphans),this._leadingOrphans=[],e.reverse(),f=!0;break;case"merge":console.warn("Due to the whims of product management, `merge` layouts are not yet implemented."),this.updateLayoutFrom(e,r.mergeStartIndex);break;case"relayout":e=this._leadingOrphans.concat(this._layoutItems.concat(this._trailingOrphans)),this._layoutItems=[],this._leadingOrphans=[],this._trailingOrphans=[],this._containerHeight=this.containerPadding.top,this._rows=[],this._orphans=[];break;case"append":default:e=this._trailingOrphans.concat(e),this._trailingOrphans=[],this._containerHeight=this._containerHeight-this.containerPadding.bottom+this.itemSpacing.vertical}return e.some(function(e,t){h=!1,l||(l=m.createNewRow(f)),c=l.addItem(e);if(l.isLayoutComplete()){o=o.concat(m.addRow(l,f));if(m._rows.length>=m.maxNumRows)return l=null,!0;l=m.createNewRow(f);if(!c){c=l.addItem(e);if(l.isLayoutComplete()){o=o.concat(m.addRow(l,f));if(m._rows.length>=m.maxNumRows)return l=null,!0;l=m.createNewRow(f)}else c||(h=!0)}}else c||(h=!0);h&&m.appContext.warn("PhotoListLayout::computeLayout() Item not added and layout not complete:",e)}),this._rows.length>=this.maxNumRows?this._trailingOrphans=e.slice(this._layoutItems.length):l&&l.getItems().length&&(f?r.firstPage?(l.forceComplete(!0),o=o.concat(m.addRow(l,f))):this._leadingOrphans=l.getItems().reverse():r.lastPage||this.alwaysDisplayOrphans?(this._rows.length?(v=this._rows[this._rows.length-1].height,l.forceComplete(!1,v)):this.alwaysDisplayOrphans&&s.length?s[s.length-1].geometry&&l.forceComplete(!1,s[s.length-1].geometry.height):l.forceComplete(!1),o=o.concat(m.addRow(l,f))):this._trailingOrphans=l.getItems().concat()),o.forEach(function(e){i[e.id]?a.push(e):u.push(e)}),this._containerHeight=this._containerHeight-this.itemSpacing.vertical+this.containerPadding.bottom,f&&(d=this.containerPadding.top,this._rows.forEach(function(e){e.setTop(d),d+=e.height+m.itemSpacing.vertical}),a=s.concat()),p=this.computeWakeSleep(t,i).wakeSleepChangedItems,this._trailingOrphans.concat(this._leadingOrphans).forEach(function(e){i[e.id]&&(e.isAwake=!1,p.push(e))}),{allLayoutItems:this._layoutItems.concat(),newItems:u,layoutChangedItems:a,wakeSleepChangedItems:p,leadingOrphans:this._leadingOrphans.concat(),trailingOrphans:this._trailingOrphans.concat(),containerHeight:this._containerHeight}},computeWakeSleep:function(e,t){var n=this._awakeItems=[];e||(e=0);var r=this.viewportContainerNodeHeight,i=.5*r*(this.awakeBoundsToViewportSizeRatio-1),s=e-i,o=e+r+i,u,a=[],f,l;return t?u=function(e){f=t[e.id],l=f&&f.isAwake,e.isAwake=e.geometry.top+e.geometry.height>=s&&e.geometry.top<o,(!f||l!==e.isAwake)&&a.push(e),e.isAwake&&n.push(e)}:u=function(e){l=e.isAwake,e.isAwake=e.geometry.top+e.geometry.height>=s&&e.geometry.top<o,l!==e.isAwake&&a.push(e),e.isAwake&&n.push(e)},this._layoutItems.forEach(u),{allLayoutItems:t?this._layoutItems:this._layoutItems.concat(),newItems:[],layoutChangedItems:[],wakeSleepChangedItems:a,leadingOrphans:this._leadingOrphans.concat(),trailingOrphans:this._trailingOrphans.concat(),containerHeight:this._containerHeight}},updateLayoutFrom:function(e,t){var n,r,i,s;this._layoutItems.length&&this._layoutItems.length>t&&(n=this._layoutItems[t],r=this.getRowOfItem(n.id),r&&(this._rows=this._rows.slice(0,r.index),i=this._rows[this._rows.length-1],i?this._containerHeight=i.top+i.height:this._containerHeight=0,r.indexInRow>0&&(s=this._layoutItems.splice(-r.indexInRow),s=s.map(function(e){return{id:e.id,aspectRatio:e.aspectRatio,layoutType:e.layoutType}}),e.unshift.apply(e,s))),this._layoutItems=this._layoutItems.slice(0,Math.min(this._layoutItems.length,t)))},createNewRow:function(t){return new e.PhotoListLayoutRow(
{top:this._containerHeight,left:this.containerPadding.left,width:this.containerWidth-this.containerPadding.left-this.containerPadding.right,spacing:this.itemSpacing.horizontal,targetRowHeight:this.targetRowHeight,targetRowHeightTolerance:this.targetRowHeightTolerance,edgeCaseMinRowHeight:.5*this.targetRowHeight,edgeCaseMaxRowHeight:2*this.targetRowHeight,rightToLeft:t})},addRow:function(e,t){return t?(this._rows.unshift(e),this._layoutItems=e.getItems().reverse().concat(this._layoutItems)):(this._rows.push(e),this._layoutItems=this._layoutItems.concat(e.getItems())),this._containerHeight+=e.height+this.itemSpacing.vertical,e.items},getRowOfItem:function(e){var t,n,r;for(n=0;n<this._rows.length;n++){t=this._rows[n],r=t.getIndexOfItem(e);if(r!==-1)return{row:t,index:n,indexInRow:r}}return null}}},"@VERSION@",{requires:["photo-list-layout-row"]});
